import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as O,j as i,r as b}from"./client-CPB5g9vB.js";const I=(t,e)=>e.some(n=>t instanceof n);let E,S;function V(){return E||(E=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k(){return S||(S=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const p=new WeakMap,y=new WeakMap,x=new WeakMap;function F(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{n(f(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",a),t.addEventListener("error",o)});return x.set(e,t),e}function R(t){if(p.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});p.set(t,e)}let j={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return p.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function M(t){j=t(j)}function W(t){return k().includes(t)?function(...e){return t.apply(g(this),e),f(this.request)}:function(...e){return f(t.apply(g(this),e))}}function N(t){return typeof t=="function"?W(t):(t instanceof IDBTransaction&&R(t),I(t,V())?new Proxy(t,j):t)}function f(t){if(t instanceof IDBRequest)return F(t);if(y.has(t))return y.get(t);const e=N(t);return e!==t&&(y.set(t,e),x.set(e,t)),e}const g=t=>x.get(t);function K(t,e,{blocked:n,upgrade:r,blocking:s,terminated:a}={}){const o=indexedDB.open(t,e),d=f(o);return r&&o.addEventListener("upgradeneeded",c=>{r(f(o.result),c.oldVersion,c.newVersion,f(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),d.then(c=>{a&&c.addEventListener("close",()=>a()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),d}const U=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],D=new Map;function T(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(D.get(e))return D.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||U.includes(n)))return;const a=async function(o,...d){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(d.shift())),(await Promise.all([u[n](...d),s&&c.done]))[0]};return D.set(e,a),a}M(t=>({...t,get:(e,n,r)=>T(e,n)||t.get(e,n,r),has:(e,n)=>!!T(e,n)||t.has(e,n)}));const $=["continue","continuePrimaryKey","advance"],P={},B=new WeakMap,C=new WeakMap,q={get(t,e){if(!$.includes(e))return t[e];let n=P[e];return n||(n=P[e]=function(...r){B.set(this,C.get(this)[e](...r))}),n}};async function*z(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,q);for(C.set(n,e),x.set(n,g(e));e;)yield n,e=await(B.get(n)||e.continue()),B.delete(n)}function A(t,e){return e===Symbol.asyncIterator&&I(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&I(t,[IDBIndex,IDBObjectStore])}M(t=>({...t,get(e,n,r){return A(e,n)?z:t.get(e,n,r)},has(e,n){return A(e,n)||t.has(e,n)}}));async function G(t){await t.createObjectStore("todos",{keyPath:"id",autoIncrement:!0})}async function H(){return await K("to-do-app-db",1,{upgrade:G})}const h=H(),l={async add(t){const n=(await h).transaction("todos","readwrite");n.objectStore("todos").add(t),await n.done},async getAll(){return(await h).transaction("todos","readwrite").objectStore("todos").getAll()},async remove(t){const n=(await h).transaction("todos","readwrite");n.objectStore("todos").delete(t),await n.done},async update(t){const n=(await h).transaction("todos","readwrite");n.objectStore("todos").put(t),await n.done},async clear(){const e=(await h).transaction("todos","readwrite");e.objectStore("todos").clear(),await e.done}};function J(){const[t,e]=b.useState([]);b.useEffect(()=>{l.getAll().then(e)},[]);function n(o){o.preventDefault();const d={id:Date.now(),text:new FormData(o.target).get("todo-text")};l.add(d).then(l.getAll).then(e)}const r=o=>d=>{e((u=>w=>w.filter(m=>m.id!==u.id))(o)),l.remove(o.id).then(l.getAll).then(e)},s=o=>()=>{l.update(o).then(l.getAll).then(e)},a=()=>l.clear().then(l.getAll).then(e);return i.jsxs("main",{children:[i.jsx("h1",{children:"To Do App"}),i.jsx(L,{onSubmit:n,inputName:"todo-text",buttonText:"Add"}),i.jsx("button",{onClick:()=>a(),children:"Clear All To Do Items"}),i.jsx("h2",{children:"To Do List"}),i.jsx("ul",{children:t.map(o=>i.jsx(Q,{todo:o,todoRemover:r,todoUpdater:s},o.id))})]})}function Q({todo:t,todoRemover:e,todoUpdater:n}){const{id:r,text:s}=t,[a,o]=b.useState(!1),d="updater-todo-text",c="Update",u=s;function w(m){m.preventDefault();const v=new FormData(m.target).get(d);n({id:r,text:v})(),o(!1)}return a?i.jsx(L,{onSubmit:w,inputName:d,buttonText:c,placeholder:u}):i.jsxs("li",{children:[i.jsx("span",{children:s}),i.jsx("button",{onClick:e({id:r,text:s}),children:"Delete"}),i.jsx("button",{onClick:()=>o(!0),children:"Edit"})]})}function L({onSubmit:t,inputName:e,buttonText:n,placeholder:r="",defaultValue:s=""}){return i.jsxs("form",{onSubmit:t,children:[i.jsx("input",{type:"text",name:e,placeholder:r,defaultValue:s,required:!0}),i.jsx("button",{type:"submit",children:n})]})}O.createRoot(document.querySelector("body")).render(i.jsx(b.StrictMode,{children:i.jsx(J,{})}));
